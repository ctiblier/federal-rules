---
import '../styles/global.css';
import RuleSidebar from '../components/RuleSidebar.astro';
import Header from '../components/Header.astro';

interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = 'Federal Rules of Civil Procedure — professional reference for attorneys and law students.',
} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{title} — Federal Rules of Civil Procedure</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="stylesheet" href="/pagefind/pagefind-ui.css" />
  </head>
  <body class="min-h-screen" style="background-color: #f8f5f0;">

    <!-- Mobile sidebar toggle -->
    <button
      id="sidebar-toggle"
      aria-label="Open rule navigation"
      aria-expanded="false"
      aria-controls="rule-sidebar"
      class="fixed top-3 left-3 z-50 p-2 rounded shadow-md md:hidden"
      style="background-color: #1a2744; color: white;"
    >
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" aria-hidden="true">
        <path d="M2 4.5h14M2 9h14M2 13.5h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
    </button>

    <!-- Mobile overlay -->
    <div
      id="sidebar-overlay"
      class="fixed inset-0 z-30 hidden md:hidden"
      style="background-color: rgba(0,0,0,0.5);"
      aria-hidden="true"
    ></div>

    <div class="flex min-h-screen">
      <!-- Left sidebar: fixed on mobile, sticky on desktop -->
      <aside
        id="rule-sidebar"
        class="fixed top-0 left-0 h-full w-[220px] z-40 overflow-y-auto
               -translate-x-full transition-transform duration-200
               md:sticky md:translate-x-0 md:top-0 md:h-screen md:shrink-0"
        style="background-color: #1a2744; color: white;"
        aria-label="Rule navigation"
      >
        <RuleSidebar />
      </aside>

      <!-- Main content column -->
      <div class="flex-1 min-w-0 flex flex-col">
        <Header />
        <main id="main-content" tabindex="-1">
          <slot />
        </main>
      </div>
    </div>

    <script is:inline>
      const toggle = document.getElementById('sidebar-toggle');
      const sidebar = document.getElementById('rule-sidebar');
      const overlay = document.getElementById('sidebar-overlay');

      function openSidebar() {
        sidebar.classList.remove('-translate-x-full');
        overlay.classList.remove('hidden');
        toggle.setAttribute('aria-label', 'Close rule navigation');
        toggle.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
      }

      function closeSidebar() {
        sidebar.classList.add('-translate-x-full');
        overlay.classList.add('hidden');
        toggle.setAttribute('aria-label', 'Open rule navigation');
        toggle.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      }

      toggle.addEventListener('click', () => {
        toggle.getAttribute('aria-expanded') === 'true' ? closeSidebar() : openSidebar();
      });
      overlay.addEventListener('click', closeSidebar);
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeSidebar();
      });
    </script>
  </body>
</html>
